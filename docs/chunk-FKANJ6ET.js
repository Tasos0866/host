import{a as q}from"./chunk-GL3AGNQ6.js";import{a as D}from"./chunk-X3FAMIGX.js";import{b as x}from"./chunk-NEN62UNH.js";import{c as y,d as T,e as W,f as E,g as I,h as F,i as H,j as B,k as A,l as L,m as N,o as O}from"./chunk-H7QKMAAS.js";import"./chunk-65CRZK2F.js";import{Ab as f,Bb as g,Cb as b,Db as _,Ea as a,Eb as v,Ib as s,Ja as C,Jb as u,Kb as M,Pa as P,Za as h,eb as r,ec as w,fb as n,gb as c,mb as d,pc as V,yb as l,zb as p}from"./chunk-RDUCI247.js";var z=class S{constructor(e){this.sunAwningsPriceService=e;e.hasData()?this.initializeView():e.loadPricesFromSheet().subscribe(()=>{this.initializeView()})}minWidthValue=150;maxWidthValue=1500;minHeightValue=150;maxHeightValue=500;width=this.minWidthValue;height=this.minHeightValue;fabricPricePerSquareMeter=0;fabricNameList=[];totalPrice=null;totalPriceWithTax=null;tax=null;squareMeters=0;fabricPrices={};motorCost=0;motorSelected;initializeView(){this.motorSelected=!1,this.updateMotorCost(),this.initializeFabricField(),this.calculateTotalPrice()}initializeFabricField(){this.fabricNameList=this.sunAwningsPriceService.getFabricNameList("fabrics_struts"),this.fabricPrices=this.sunAwningsPriceService.getFabricPrices("fabrics_struts")}clampValue(e,i,t){return Math.min(Math.max(e,i),t)}handleWidthChange(e,i){this.width=this.clampValue(e,this.minWidthValue,this.maxWidthValue),i.value=String(this.width)}handleHeightChange(e,i){this.height=this.clampValue(e,this.minHeightValue,this.maxHeightValue),i.value=String(this.height)}calculateHeavyDutySupportCharge(){return this.width>600?this.motorSelected?this.sunAwningsPriceService.getExtraInfo("heavy_duty_base_motor"):this.sunAwningsPriceService.getExtraInfo("heavy_duty_base"):0}minimumCostCheck(e){let i=this.squareMeters*e;return i<250?250:i}onBlur(e,i){let t=e.target;if(!t)return;let m=Number(t.value);i==="width"?this.handleWidthChange(m,t):i==="height"&&this.handleHeightChange(m,t),this.updateMotorCost(),this.calculateTotalPrice()}updateFabricPrice(e){e&&(this.fabricPricePerSquareMeter=e,this.calculateTotalPrice())}onMotorChange(e){this.motorSelected=e,this.calculateTotalPrice()}updateMotorCost(){if(this.valuesOutOfRange()){this.motorCost=0;return}this.motorCost=this.sunAwningsPriceService.getExtraInfo(this.width>600?"motor_od_large":"motor_od_small")}calculateTotalPrice(){if(this.valuesOutOfRange()){this.totalPrice=null,this.totalPriceWithTax=null,this.tax=null;return}let e=this.sunAwningsPriceService.getExtraInfo("VAT")/100,i=this.calculateHeavyDutySupportCharge();this.squareMeters=(this.width+10)*(this.height+70)/1e4;let t=this.minimumCostCheck(this.fabricPricePerSquareMeter);this.totalPrice=Math.floor(t+(this.motorSelected?this.motorCost:0)+i),this.tax=Math.floor(this.totalPrice*e),this.totalPriceWithTax=Math.floor(this.totalPrice+this.tax)}valuesOutOfRange(){return this.width<this.minWidthValue||this.width>this.maxWidthValue||this.height<this.minHeightValue||this.height>this.maxHeightValue}static \u0275fac=function(i){return new(i||S)(C(x))};static \u0275cmp=P({type:S,selectors:[["app-struts"]],decls:45,vars:48,consts:[[1,"struts","product-container"],[1,"awning-title"],[1,"desktop-layout"],[1,"svg-width"],["src","assets/img/sun-awnings/struts.webp","alt","Awning with struts illustration",1,"awning-image"],[1,"form-fields"],[1,"awning-title-desktop"],[1,"dimensions-title"],[1,"dimensions-fields"],["appearance","outline",1,"width-field"],["matInput","","type","number",3,"ngModelChange","blur","ngModel","min","max"],["appearance","outline"],["appearance","outline",1,"field","left-field","m2-field"],["readonly","","matInput","","type","text",3,"value"],[3,"updateFabricPrice","fabricNameList","fabricPrices"],[3,"updateMotorState","motorCost"],[3,"totalPriceWithTax","totalPrice","tax"]],template:function(i,t){i&1&&(r(0,"div",0)(1,"h1",1),l(2),s(3,"translate"),n(),r(4,"div",2)(5,"div",3),c(6,"img",4),n(),r(7,"div",5)(8,"h1",6),l(9),s(10,"translate"),n(),r(11,"h4",7),l(12),s(13,"translate"),n(),r(14,"div",8)(15,"mat-form-field",9)(16,"mat-label"),l(17),s(18,"translate"),n(),r(19,"input",10),v("ngModelChange",function(o){return _(t.width,o)||(t.width=o),o}),d("ngModelChange",function(){return t.updateMotorCost(),t.calculateTotalPrice()})("blur",function(o){return t.onBlur(o,"width")}),n(),r(20,"mat-hint"),l(21),n()(),r(22,"mat-form-field",11)(23,"mat-label"),l(24),s(25,"translate"),n(),r(26,"input",10),v("ngModelChange",function(o){return _(t.height,o)||(t.height=o),o}),d("ngModelChange",function(){return t.updateMotorCost(),t.calculateTotalPrice()})("blur",function(o){return t.onBlur(o,"height")}),n(),r(27,"mat-hint"),l(28),n()()(),r(29,"mat-form-field",12)(30,"mat-label"),l(31),s(32,"translate"),n(),c(33,"input",13),s(34,"number"),n(),r(35,"h4"),l(36),s(37,"translate"),s(38,"translate"),n(),r(39,"app-fabric-selection",14),d("updateFabricPrice",function(o){return t.updateFabricPrice(o)}),n(),r(40,"h4"),l(41),s(42,"translate"),n(),r(43,"app-motor-selection",15),d("updateMotorState",function(o){return t.onMotorChange(o)}),n(),c(44,"app-total-price-card",16),n()()()),i&2&&(a(2),p(u(3,27,"struts_title")),a(7),p(u(10,29,"struts_title")),a(3),p(u(13,31,"dimensions")),a(5),f("",u(18,33,"width")," (cm)"),a(2),b("ngModel",t.width),h("min",t.minWidthValue)("min",t.minWidthValue)("max",t.maxWidthValue),a(2),g("Min: ",t.minWidthValue," cm, Max: ",t.maxWidthValue," cm"),a(3),f("",u(25,35,"height")," (cm)"),a(2),b("ngModel",t.height),h("min",t.minHeightValue)("max",t.maxHeightValue),a(2),g("Min: ",t.minHeightValue," cm, Max: ",t.maxHeightValue," cm"),a(3),p(u(32,37,"fabric_m2")),a(2),h("value",M(34,39,t.squareMeters,"1.2-2")),a(3),g("",u(37,42,"fabric")," (",u(38,44,"price_per_m2"),")"),a(3),h("fabricNameList",t.fabricNameList)("fabricPrices",t.fabricPrices),a(2),p(u(42,46,"electric_motor")),a(2),h("motorCost",t.motorCost),a(),h("totalPriceWithTax",t.totalPriceWithTax)("totalPrice",t.totalPrice)("tax",t.tax))},dependencies:[L,B,N,H,y,E,T,F,I,W,A,O,w,V,D,q],styles:[".struts[_ngcontent-%COMP%]{min-width:320px;margin-top:24px;min-height:90%}mat-radio-button[_ngcontent-%COMP%]:first-child{margin-right:8px}.m2-field[_ngcontent-%COMP%]{align-self:start}@media (max-width: 535px){.m2-field[_ngcontent-%COMP%]{width:100%}}"]})};export{z as StrutsComponent};

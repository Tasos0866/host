import{Q as d,T as f,Y as g,l as m,mc as N,p as u,v as b}from"./chunk-W6CIVE6P.js";var v=class p{constructor(e){this.http=e}sheetId="1pcj6_7nTUNu-2tzmPL4hK0pDHbkaY6zfHC17Q78eX-0";apiKey="AIzaSyCAwFwYxXOfrY2ZHGgyA7J6yaIzDJLgu-k";url=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values`;priceTables={};generalTable={};minProjections={};maxProjections={};minWidths={};maxWidths={};cacheTimestamp=null;cacheDuration=5*60*1e3;loadPricesFromSheet(){let e=Date.now();if(this.cacheTimestamp&&e-this.cacheTimestamp<this.cacheDuration)return m(void 0);let a=this.http.get(`${this.url}/Sheet1?key=${this.apiKey}`).pipe(u(t=>this.processFirstSheetData(t.values))),i=this.http.get(`${this.url}/Sheet2?key=${this.apiKey}`).pipe(u(t=>this.processSecondSheetData(t.values)));return b([a,i]).pipe(d(()=>{this.cacheTimestamp=Date.now()}),u(()=>{}))}processFirstSheetData(e){let a=this.extractTables(e);Object.entries(a).forEach(([i,t])=>{let r=i.toLowerCase().endsWith("_1d"),n=i.replace(/_1d$/i,""),s=this.parsePriceTable(t,!r);this.priceTables[n]=s;let o=Object.keys(s).map(Number);if(this.minProjections[n]=Math.min(...o),this.maxProjections[n]=Math.max(...o),!r){let c=Object.values(s).flatMap(l=>Object.keys(l).map(Number));this.minWidths[n]=Math.min(...c),this.maxWidths[n]=Math.max(...c)}})}processSecondSheetData(e){let a={};e.forEach(i=>{let t=i[0],r=Number(i[1]);t&&!isNaN(r)&&(a[t]=r)}),this.generalTable=a}findNearestGreaterOrEqual(e,a){let i=0,t=e.length-1;for(;i<=t;){let r=Math.floor((i+t)/2);if(e[r]===a)return e[r];e[r]<a?i=r+1:t=r-1}return i<e.length?e[i]:null}extractTables(e){let a={};for(let i=0;i<e.length;i++){let t=e[i];if(t[0]&&isNaN(Number(t[0]))){let r=t[0],n=[],s=i+1;for(;s<e.length&&!(e[s][0]&&isNaN(Number(e[s][0])));)n.push(e[s]),s++;a[r]=[e[i],...n]}}return a}parsePriceTable(e,a){if(!a){let r={};for(let n of e){let s=Number(n[0]),o=Number(n[1]);!isNaN(s)&&!isNaN(o)&&(r[s]=o)}return r}let i=e[0].slice(1).map(r=>Number(r)).filter(r=>!isNaN(r)),t={};for(let r=1;r<e.length;r++){let n=e[r],s=Number(n[0]);if(!isNaN(s)){t[s]={};for(let o=1;o<n.length;o++){let c=i[o-1],l=Number(n[o]);isNaN(l)||(t[s][c]=l)}}}return t}getTable(){return this.priceTables}hasData(){return Object.keys(this.priceTables).length>0&&Object.keys(this.generalTable).length>0}getGeneralTable(){return this.generalTable}getPrice(e,a,i){let t=this.priceTables[e];if(!t)return null;if(typeof Object.values(t)[0]=="number"){let n=t,s=Object.keys(n).map(Number),o=this.findNearestGreaterOrEqual(s,a);return o!==null?n[o]:null}else{let n=t,s=Object.keys(n).map(Number),o=this.findNearestGreaterOrEqual(s,a);if(o===null)return null;let c=n[o],l=Object.keys(c).map(Number),h=this.findNearestGreaterOrEqual(l,i);return h!==null?c[h]:null}}getMinProjection(e){return this.minProjections[e]??null}getMaxProjection(e){return this.maxProjections[e]??null}getMinWidth(e){return this.minWidths[e]??null}getMaxWidth(e){return this.maxWidths[e]??null}static \u0275fac=function(a){return new(a||p)(g(N))};static \u0275prov=f({token:p,factory:p.\u0275fac,providedIn:"root"})};export{v as a};

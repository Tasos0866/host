import{b as R}from"./chunk-NEN62UNH.js";import{c as H,d as B,e as O,f as N,g as F,h as L,i as A,j as D,k as q,l as z,m as k,o as j,p as G,q as J}from"./chunk-H7QKMAAS.js";import"./chunk-65CRZK2F.js";import{Ab as f,Bb as C,Cb as M,Db as b,Ea as i,Eb as w,Ib as m,Ja as S,Jb as s,Kb as P,Pa as V,Ta as T,Za as h,ac as W,da as v,ea as x,eb as r,ec as E,fb as a,gb as c,kb as y,mb as g,nb as _,pc as I,yb as o,zb as d}from"./chunk-RDUCI247.js";function Q(u,n){if(u&1){let t=y();r(0,"mat-chip-option",17),g("selectionChange",function(){let p=v(t).$implicit,l=_();return l.repairType=p,x(l.calculateTotalPrice())}),o(1),m(2,"translate"),a()}if(u&2){let t=n.$implicit,e=_();h("selected",e.repairType===t)("selectable",e.repairType!==t),i(),f(" ",s(2,3,t)," ")}}var K=class u{constructor(n){this.sunAwningsPriceService=n;n.hasData()?this.initializeView():n.loadPricesFromSheet().subscribe(()=>{this.initializeView()})}minWidthValue=150;maxWidthValue=1500;minHeightValue=150;maxHeightValue=500;width=this.minWidthValue;height=this.minHeightValue;repairType="fabric_sewing";repairNameList=["fabric_sewing","motor_repair","both"];totalPrice=null;totalPriceWithTax=null;tax=null;squareMeters=0;motorCost=0;motorSelected=!1;fabricRepairSelected=!1;initializeView(){this.updateMotorCost(),this.calculateTotalPrice()}clampValue(n,t,e){return Math.min(Math.max(n,t),e)}handleWidthChange(n,t){this.width=this.clampValue(n,this.minWidthValue,this.maxWidthValue),t.value=String(this.width)}handleHeightChange(n,t){this.height=this.clampValue(n,this.minHeightValue,this.maxHeightValue),t.value=String(this.height)}onBlur(n,t){let e=n.target;if(!e)return;let p=Number(e.value);t==="width"?this.handleWidthChange(p,e):t==="height"&&this.handleHeightChange(p,e),this.updateMotorCost(),this.calculateTotalPrice()}updateMotorCost(){if(this.valuesOutOfRange()){this.motorCost=0;return}this.motorCost=this.sunAwningsPriceService.getExtraInfo(this.width>600?"motor_repair_large":"motor_repair_small")}calculateTotalPrice(){if(this.fabricRepairSelected=this.repairType==="fabric_sewing"||this.repairType==="both",this.motorSelected=this.repairType==="motor_repair"||this.repairType==="both",this.valuesOutOfRange()){this.totalPrice=null,this.totalPriceWithTax=null,this.tax=null;return}let n=this.sunAwningsPriceService.getExtraInfo("VAT")/100;this.squareMeters=(this.width+10)*(this.height+70)/1e4,this.totalPrice=Math.floor((this.fabricRepairSelected?this.squareMeters*8:0)+(this.motorSelected?this.motorCost:0)),this.tax=Math.floor(this.totalPrice*n),this.totalPriceWithTax=Math.floor(this.totalPrice+this.tax)}valuesOutOfRange(){return this.width<this.minWidthValue||this.width>this.maxWidthValue||this.height<this.minHeightValue||this.height>this.maxHeightValue}static \u0275fac=function(t){return new(t||u)(S(R))};static \u0275cmp=V({type:u,selectors:[["app-repair"]],decls:41,vars:40,consts:[[1,"repair","product-container"],[1,"awning-title"],[1,"desktop-layout"],[1,"svg-width"],["src","assets/img/sun-awnings/repair.webp","alt","Awning repair illustration",1,"awning-image"],[1,"form-fields"],[1,"awning-title-desktop"],[1,"dimensions-title"],[1,"dimensions-fields"],["appearance","outline",1,"width-field"],["matInput","","type","number",3,"ngModelChange","blur","ngModel","min","max"],["appearance","outline"],["subscriptSizing","dynamic","appearance","outline",1,"field","left-field","m2-field"],["readonly","","matInput","","type","text",3,"value"],["aria-label","Repair type selection",1,"field",3,"hideSingleSelectionIndicator"],[3,"selected","selectable","selectionChange",4,"ngFor","ngForOf"],[3,"totalPriceWithTax","totalPrice","tax"],[3,"selectionChange","selected","selectable"]],template:function(t,e){t&1&&(r(0,"div",0)(1,"h1",1),o(2),m(3,"translate"),a(),r(4,"div",2)(5,"div",3),c(6,"img",4),a(),r(7,"div",5)(8,"h1",6),o(9),m(10,"translate"),a(),r(11,"h4",7),o(12),m(13,"translate"),a(),r(14,"div",8)(15,"mat-form-field",9)(16,"mat-label"),o(17),m(18,"translate"),a(),r(19,"input",10),w("ngModelChange",function(l){return b(e.width,l)||(e.width=l),l}),g("ngModelChange",function(){return e.updateMotorCost(),e.calculateTotalPrice()})("blur",function(l){return e.onBlur(l,"width")}),a(),r(20,"mat-hint"),o(21),a()(),r(22,"mat-form-field",11)(23,"mat-label"),o(24),m(25,"translate"),a(),r(26,"input",10),w("ngModelChange",function(l){return b(e.height,l)||(e.height=l),l}),g("ngModelChange",function(){return e.updateMotorCost(),e.calculateTotalPrice()})("blur",function(l){return e.onBlur(l,"height")}),a(),r(27,"mat-hint"),o(28),a()()(),r(29,"mat-form-field",12)(30,"mat-label"),o(31),m(32,"translate"),a(),c(33,"input",13),m(34,"number"),a(),r(35,"h4"),o(36),m(37,"translate"),a(),r(38,"mat-chip-listbox",14),T(39,Q,3,5,"mat-chip-option",15),a(),c(40,"app-total-price-card",16),a()()()),t&2&&(i(2),d(s(3,23,"awning_repair")),i(7),d(s(10,25,"awning_repair")),i(3),d(s(13,27,"dimensions")),i(5),f("",s(18,29,"width")," (cm)"),i(2),M("ngModel",e.width),h("min",e.minWidthValue)("max",e.maxWidthValue),i(2),C("Min: ",e.minWidthValue," cm, Max: ",e.maxWidthValue," cm"),i(3),f("",s(25,31,"height")," (cm)"),i(2),M("ngModel",e.height),h("min",e.minHeightValue)("max",e.maxHeightValue),i(2),C("Min: ",e.minHeightValue," cm, Max: ",e.maxHeightValue," cm"),i(3),d(s(32,33,"fabric_m2")),i(2),h("value",P(34,35,e.squareMeters,"1.2-2")),i(3),d(s(37,38,"repair_type")),i(2),h("hideSingleSelectionIndicator",!0),i(),h("ngForOf",e.repairNameList),i(),h("totalPriceWithTax",e.totalPriceWithTax)("totalPrice",e.totalPrice)("tax",e.tax))},dependencies:[A,H,N,B,L,F,O,I,z,q,k,D,E,j,J,G,W],styles:[".repair[_ngcontent-%COMP%]{min-width:320px;margin-top:24px}.m2-field[_ngcontent-%COMP%]{align-self:start}@media (max-width: 535px){.m2-field[_ngcontent-%COMP%]{width:100%}}"]})};export{K as RepairComponent};

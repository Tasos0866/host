import{P as y,S as p,X as h,l as f,lc as P,p as m,u as g}from"./chunk-RDUCI247.js";var d=class o{armDetailsMap={100:{extended:160,type:"Prestige Plus"},105:{extended:180,type:"Prestige Plus"},120:{extended:200,type:"Prestige Plus"},132:{extended:225,type:"Prestige Plus"},151:{extended:250,type:"Prestige Plus"},156:{extended:275,type:"Prestige Plus"},170:{extended:300,type:"Maxi"},181:{extended:325,type:"Maxi"},194:{extended:350,type:"Maxi"},206:{extended:375,type:"Maxi"},221:{extended:400,type:"Maxi"},250:{extended:425,type:"Hercules"},260:{extended:450,type:"Hercules"},274:{extended:475,type:"Hercules"},300:{extended:500,type:"Hercules"}};armPrices={};armsConfig=[{maxWidth:800,requiredArms:4},{maxWidth:1200,requiredArms:6},{maxWidth:1500,requiredArms:8}];updateArmPrices(e){this.armPrices=e}getPrice(e){if(e<160||e>500)return null;let i=Object.keys(this.armPrices).map(Number).sort((t,s)=>t-s).find(t=>t>=e);return i!==void 0?this.armPrices[i]:null}getExtendedByFolded(e){let r=this.armDetailsMap[e];return r?r.extended:null}getTypeByFolded(e){let r=this.armDetailsMap[e];return this.armDetailsMap[e]?r.type:null}getMaxHeight(e){let r=this.findLargestFoldedLength(e);return r!==null?this.armDetailsMap[r]?.extended??null:null}findLargestFoldedLength(e){let r=e/2,i=Object.keys(this.armDetailsMap).map(Number).sort((t,s)=>s-t);for(let t of i)if(r>=t)return t;return null}getNumberOfArms(e,r){let i=Math.floor(e/r);if(e<=550)return 2;for(let t of this.armsConfig)if(e<=t.maxWidth)return this.getValidArms(r,i,t.requiredArms);return null}findFoldedByHeight(e){let r=Object.entries(this.armDetailsMap).map(([i,t])=>({folded:Number(i),extended:t.extended})).sort((i,t)=>i.extended-t.extended);for(let i of r)if(e<=i.extended)return i.folded;return null}getValidArms(e,r,i){for(let t=i;t>=2;t--)if(r>=t&&e*t<=r*e)return t;return null}static \u0275fac=function(r){return new(r||o)};static \u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})};var v=class o{constructor(e,r){this.http=e;this.armDetailsService=r}sheetId="1T8WdAkaU0G2JSztSReUC3WiX5ZVkdtbQ7YKCjtv-Vbw";apiKey="AIzaSyCAwFwYxXOfrY2ZHGgyA7J6yaIzDJLgu-k";url=`https://sheets.googleapis.com/v4/spreadsheets/${this.sheetId}/values`;priceTables={};cacheTimestamp=null;cacheDuration=5*60*1e3;simpleTables={};loadPricesFromSheet(){let e=Date.now();if(this.cacheTimestamp&&e-this.cacheTimestamp<this.cacheDuration)return f(void 0);let r=this.http.get(`${this.url}/Sheet1?key=${this.apiKey}`).pipe(m(t=>this.processFirstSheetData(t.values))),i=this.http.get(`${this.url}/Sheet2?key=${this.apiKey}`).pipe(m(t=>this.processSecondSheetData(t.values)));return g([r,i]).pipe(y(()=>{this.cacheTimestamp=Date.now()}),m(()=>{}))}processFirstSheetData(e){let r=this.extractTables(e);Object.entries(r).forEach(([i,t])=>{let s=i.toLowerCase().endsWith("_1d"),n=i.replace(/_1d$/i,"");this.priceTables[n]=this.parsePriceTable(t,!s)})}processSecondSheetData(e){let r=null,i=[];for(let t of e){let s=t[0]?.trim(),n=t[1]?.trim();if(s&&!n){r=s,this.simpleTables[r]||(this.simpleTables[r]={});continue}if(!s||!n||!r)continue;if(r==="arm_prices"){this.collectArmPricesData(s,n,i);continue}let a=Number(n);isNaN(a)||(this.simpleTables[r][s]=a)}this.updateArmPrices(i)}collectArmPricesData(e,r,i){let t=Number(e),s=Number(r);!isNaN(t)&&!isNaN(s)&&i.push({extended:t,price:s})}updateArmPrices(e){if(e.length>0){let r=e.reduce((i,t)=>(i[t.extended]=t.price,i),{});this.armDetailsService.updateArmPrices(r)}}extractTables(e){let r={};for(let i=0;i<e.length;i++){let t=e[i];if(t[0]&&isNaN(Number(t[0]))){let s=t[0],n=[],a=i+1;for(;a<e.length&&!(e[a][0]&&isNaN(Number(e[a][0])));)n.push(e[a]),a++;r[s]=[e[i],...n]}}return r}parsePriceTable(e,r){if(!r){let s={};for(let n of e){let a=Number(n[0]),l=Number(n[1]);!isNaN(a)&&!isNaN(l)&&(s[a]=l)}return s}let i=e[0].slice(1).map(s=>Number(s)).filter(s=>!isNaN(s)),t={};for(let s=1;s<e.length;s++){let n=e[s],a=Number(n[0]);if(!isNaN(a)){t[a]={};for(let l=1;l<n.length;l++){let c=i[l-1],u=Number(n[l]);isNaN(u)||(t[a][c]=u)}}}return t}findNearestGreaterOrEqual(e,r){let i=0,t=e.length-1;for(;i<=t;){let s=Math.floor((i+t)/2);if(e[s]===r)return e[s];e[s]<r?i=s+1:t=s-1}return i<e.length?e[i]:null}getPrice(e,r,i){let t=this.priceTables[e];if(!t)return null;if(typeof Object.values(t)[0]=="number"){let n=t,a=Object.keys(n).map(Number),l=this.findNearestGreaterOrEqual(a,r);return l!==null?n[l]:null}else{let n=t,a=Object.keys(n).map(Number),l=this.findNearestGreaterOrEqual(a,r);if(l===null)return null;let c=n[l],u=Object.keys(c).map(Number),b=this.findNearestGreaterOrEqual(u,i);return b!==null?c[b]:null}}getFabricPrices(e){return this.simpleTables[e]}getExtraInfo(e){return this.simpleTables.extras[e]}getFabricNameList(e){return Object.keys(this.simpleTables[e])}getCounterweightPrices(){return this.simpleTables.Counterweight}hasData(){return Object.keys(this.priceTables).length>0&&Object.keys(this.simpleTables).length>0}static \u0275fac=function(r){return new(r||o)(h(P),h(d))};static \u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})};export{d as a,v as b};

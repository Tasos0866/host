import{a as U}from"./chunk-E2JE6NOM.js";import{a as B,b as O,c as D,d as $,e as ee,f as te}from"./chunk-GLIYSRQJ.js";import"./chunk-BGGO3X4J.js";import{a as I}from"./chunk-Z65U56ZD.js";import{c as k,d as N,e as R,f as z,g as A,h as G,i as Q,j as H,k as q,l as J,m as K,o as X,p as Y,q as Z}from"./chunk-H7QKMAAS.js";import{w as W}from"./chunk-65CRZK2F.js";import{Ab as _,Bb as C,Cb as v,Db as b,Ea as t,Eb as V,Ib as d,Ja as f,Jb as g,Ob as x,Pa as L,Za as m,da as s,ea as p,eb as a,fb as o,gb as w,kb as T,mb as u,pc as E,qb as M,sb as y,tb as F,ub as j,yb as c,zb as P}from"./chunk-RDUCI247.js";var re=["tooltip"],ie=class S{constructor(r,n,e,i){this.pergolaPricesService=r;this.changeDetector=n;this.snackBar=e;this.translate=i;this.pergolaPricesService.hasData()?(this.setMinMaxValues(),this.initializeDimensions(),this.initializeGeneralTable(),this.updatePrices()):this.pergolaPricesService.loadPricesFromSheet().subscribe(()=>{this.setMinMaxValues(),this.initializeDimensions(),this.initializeGeneralTable(),this.updatePrices()})}minWidthValue=0;maxWidthValue=0;minProjectionValue=0;maxProjectionValue=0;width=0;projection=0;pergolaColorsList=B;fabricColorsList=O;lightsEnabled=!1;selectedLightsType="no";standardLightsPrice=null;luxLightsPrice=null;pergolaPrice=null;totalPrice=null;totalPriceWithTax=null;isOtherPergolaColorSelected=!1;perimeterLightsEnabled=!1;totalPerimeterLightsPrice=null;numberOfColumns=0;generalTable={};tooltip;tax=null;selectedPergolaColor="anthracite_7016";selectedFabricColor="#d5d4af";imageSource="assets/img/flat pergolas/anthracite_7016.svg";setMinMaxValues(){let r="Flat";this.minWidthValue=this.pergolaPricesService.getMinWidth(r),this.maxWidthValue=this.pergolaPricesService.getMaxWidth(r),this.minProjectionValue=this.pergolaPricesService.getMinProjection(r),this.maxProjectionValue=this.pergolaPricesService.getMaxProjection(r)}initializeDimensions(){this.width=this.minWidthValue,this.projection=this.minProjectionValue}updatePrices(){this.updateStandardLightsPrice(),this.updateLuxLightsPrice(),this.updatePergolaPrice(),this.updatePerimeterLightsPrice(),this.calculateTotalPrice()}updatePergolaPrice(){let n=this.pergolaPricesService.getPrice("Flat",this.projection,this.width);this.pergolaPrice=n!==null?n:null,this.isOtherPergolaColorSelected&&this.pergolaPrice!==null&&(this.pergolaPrice=Math.floor(this.pergolaPrice*1.1))}updateStandardLightsPrice(){this.width&&this.projection&&(this.standardLightsPrice=this.pergolaPricesService.getPrice("Lights_Standard",this.projection,this.width),this.changeDetector.markForCheck())}updateLuxLightsPrice(){this.width&&this.projection&&(this.luxLightsPrice=this.pergolaPricesService.getPrice("Lights_Lux",this.projection,this.width),this.changeDetector.markForCheck())}updatePerimeterLightsPrice(){this.width>=this.minWidthValue&&this.width<=this.maxWidthValue&&this.projection>=this.minProjectionValue&&this.projection<=this.maxProjectionValue?this.totalPerimeterLightsPrice=Math.floor(2*(this.width+this.projection)*(this.generalTable.led_lights/100)+this.generalTable.dimmer):this.totalPerimeterLightsPrice=null,this.changeDetector.markForCheck()}calculateTotalPrice(){if(this.valuesOutOfRange()){this.totalPrice=null,this.totalPriceWithTax=null,this.tax=null;return}let r=this.lightsEnabled?(this.selectedLightsType==="lux"?this.luxLightsPrice:this.standardLightsPrice)??0:0,n=this.perimeterLightsEnabled?this.totalPerimeterLightsPrice??0:0,e=this.numberOfColumns*(this.generalTable.column_price??0),i=this.generalTable.VAT/100;this.totalPrice=Math.floor((this.pergolaPrice??0)+r+n+e),this.tax=Math.floor(this.totalPrice*i),this.totalPriceWithTax=this.totalPrice+this.tax,this.changeDetector.markForCheck()}initializeGeneralTable(){this.generalTable=this.pergolaPricesService.getGeneralTable()}valuesOutOfRange(){return this.width<this.minWidthValue||this.width>this.maxWidthValue||this.projection<this.minProjectionValue||this.projection>this.maxProjectionValue}onLightsToggle(r){this.selectedLightsType=r,this.lightsEnabled=r!=="no",this.lightsEnabled||(this.perimeterLightsEnabled=!1),this.updatePrices()}onPerimeterLightsToggle(r){this.perimeterLightsEnabled=r==="yes",this.updatePrices()}onBlur(r,n){let e=r.target,i=Number(e.value);e&&(n==="width"?(i<this.minWidthValue?e.value=String(this.minWidthValue):i>this.maxWidthValue&&(e.value=String(this.maxWidthValue)),this.width=Number(e.value)):n==="projection"&&(i<this.minProjectionValue?e.value=String(this.minProjectionValue):i>this.maxProjectionValue&&(e.value=String(this.maxProjectionValue)),this.projection=Number(e.value)),this.updatePrices())}onBlurNumberOfColumns(r){let n=r.target;Number(n.value)<0&&(this.numberOfColumns=0,n.value="0"),this.updatePrices()}onFocusNumberOfColumns(){this.tooltip?.show()}onFabricColorChange(r){let n=this.fabricColorsList.find(e=>e.value===r.value);this.selectedFabricColor=n?.colorCode||"#d5d4af"}onPergolaColorChange(r){if(this.selectedPergolaColor=r.value,this.isOtherPergolaColorSelected=this.selectedPergolaColor==="other",this.imageSource=`assets/img/flat pergolas/${this.selectedPergolaColor}.svg`,this.isOtherPergolaColorSelected){let n=this.translate.instant("other_pergola_color_message"),e=this.translate.instant("close");this.snackBar.open(n,e,{duration:8e3})}this.updatePrices()}static \u0275fac=function(n){return new(n||S)(f(I),f(x),f(te),f(W))};static \u0275cmp=L({type:S,selectors:[["app-flat-pergola"]],viewQuery:function(n,e){if(n&1&&y(re,5),n&2){let i;F(i=j())&&(e.tooltip=i.first)}},decls:65,vars:78,consts:[["tooltip","matTooltip"],[1,"flat-pergola","product-container"],[1,"awning-title"],[1,"desktop-layout"],[1,"svg-width"],[3,"svgPath","fabricColor"],[1,"form-fields"],[1,"awning-title-desktop"],[1,"dimensions-title"],[1,"dimensions-fields"],["appearance","outline",1,"width-field"],["matInput","","type","number",3,"ngModelChange","blur","ngModel","min","max"],["appearance","outline"],["appearance","outline","matTooltipPosition","above","matTooltipClass","tooltip","autocomplete","off",1,"field","column-number-field",3,"matTooltip"],["matInput","","type","number",3,"ngModelChange","focus","blur","ngModel","min"],["align","start"],[3,"fabricColorChange","fabricColorsList","selectedFabricColor"],[3,"pergolaColorChange","pergolaColorsList","selectedPergolaColor"],["aria-label","Lights selection",1,"field",3,"hideSingleSelectionIndicator"],[3,"selectionChange","selected","selectable"],[1,"perimeter-lights-field"],["aria-label","Perimeter lights",1,"field",3,"hideSingleSelectionIndicator"],[3,"tax","totalPrice","totalPriceWithTax"]],template:function(n,e){if(n&1){let i=T();a(0,"div",1)(1,"h1",2),c(2),d(3,"translate"),o(),a(4,"div",3)(5,"div",4),w(6,"app-svg-viewer",5),o(),a(7,"div",6)(8,"h1",7),c(9),d(10,"translate"),o(),a(11,"h4",8),c(12),d(13,"translate"),o(),a(14,"div",9)(15,"mat-form-field",10)(16,"mat-label"),c(17),d(18,"translate"),o(),a(19,"input",11),V("ngModelChange",function(l){return s(i),b(e.width,l)||(e.width=l),p(l)}),u("ngModelChange",function(){return s(i),p(e.updatePrices())})("blur",function(l){return s(i),p(e.onBlur(l,"width"))}),o(),a(20,"mat-hint"),c(21),o()(),a(22,"mat-form-field",12)(23,"mat-label"),c(24),d(25,"translate"),o(),a(26,"input",11),V("ngModelChange",function(l){return s(i),b(e.projection,l)||(e.projection=l),p(l)}),u("ngModelChange",function(){return s(i),p(e.updatePrices())})("blur",function(l){return s(i),p(e.onBlur(l,"projection"))}),o(),a(27,"mat-hint"),c(28),o()()(),a(29,"mat-form-field",13,0),d(31,"translate"),a(32,"mat-label"),c(33),d(34,"translate"),o(),a(35,"input",14),V("ngModelChange",function(l){return s(i),b(e.numberOfColumns,l)||(e.numberOfColumns=l),p(l)}),u("ngModelChange",function(){return s(i),p(e.updatePrices())})("focus",function(){return s(i),p(e.onFocusNumberOfColumns())})("blur",function(l){return s(i),p(e.onBlurNumberOfColumns(l))}),o(),a(36,"mat-hint",15),c(37,"Min: 0"),o()(),a(38,"app-fabric-color-chips",16),u("fabricColorChange",function(l){return s(i),p(e.onFabricColorChange(l))}),o(),a(39,"app-pergola-color-chips",17),u("pergolaColorChange",function(l){return s(i),p(e.onPergolaColorChange(l))}),o(),a(40,"h4"),c(41),d(42,"translate"),o(),a(43,"mat-chip-listbox",18)(44,"mat-chip-option",19),u("selectionChange",function(){return s(i),p(e.onLightsToggle("no"))}),c(45),d(46,"translate"),o(),a(47,"mat-chip-option",19),u("selectionChange",function(){return s(i),p(e.onLightsToggle("standard"))}),c(48),d(49,"translate"),o(),a(50,"mat-chip-option",19),u("selectionChange",function(){return s(i),p(e.onLightsToggle("lux"))}),c(51),d(52,"translate"),o()(),a(53,"div",20)(54,"h4"),c(55),d(56,"translate"),o(),a(57,"mat-chip-listbox",21)(58,"mat-chip-option",19),u("selectionChange",function(){return s(i),p(e.onPerimeterLightsToggle("no"))}),c(59),d(60,"translate"),o(),a(61,"mat-chip-option",19),u("selectionChange",function(){return s(i),p(e.onPerimeterLightsToggle("yes"))}),c(62),d(63,"translate"),o()()(),w(64,"app-total-price-card",22),o()()()}n&2&&(t(2),P(g(3,50,"flat_pergola")),t(4),m("svgPath",e.imageSource)("fabricColor",e.selectedFabricColor),t(3),P(g(10,52,"flat_pergola")),t(3),P(g(13,54,"dimensions")),t(5),_("",g(18,56,"width")," (cm)"),t(2),v("ngModel",e.width),m("min",e.minWidthValue)("max",e.maxWidthValue),t(2),C("Min: ",e.minWidthValue," cm, Max: ",e.maxWidthValue," cm"),t(3),_("",g(25,58,"projection")," (cm)"),t(2),v("ngModel",e.projection),m("min",e.minProjectionValue)("max",e.maxProjectionValue),t(2),C("Min: ",e.minProjectionValue," cm, Max: ",e.maxProjectionValue," cm"),t(),M("matTooltip",g(31,60,"column_tooltip_text")),t(4),P(g(34,62,"number_of_columns")),t(2),v("ngModel",e.numberOfColumns),m("min",0),t(3),m("fabricColorsList",e.fabricColorsList)("selectedFabricColor",e.selectedFabricColor),t(),m("pergolaColorsList",e.pergolaColorsList)("selectedPergolaColor",e.selectedPergolaColor),t(2),P(g(42,64,"lights")),t(2),m("hideSingleSelectionIndicator",!0),t(),m("selected",e.selectedLightsType==="no")("selectable",e.selectedLightsType!=="no"),t(),_(" ",g(46,66,"no_lights")," "),t(2),m("selected",e.selectedLightsType==="standard")("selectable",e.selectedLightsType!=="standard"),t(),C(" ",g(49,68,"standard_lights")," (+",e.standardLightsPrice,"\u20AC) "),t(2),m("selected",e.selectedLightsType==="lux")("selectable",e.selectedLightsType!=="lux"),t(),C(" ",g(52,70,"lux_lights")," (+",e.luxLightsPrice,"\u20AC) "),t(4),P(g(56,72,"perimeter_lights")),t(2),m("hideSingleSelectionIndicator",!0),t(),m("selected",!e.perimeterLightsEnabled)("selectable",e.perimeterLightsEnabled),t(),_(" ",g(60,74,"no")," "),t(2),m("selected",e.perimeterLightsEnabled)("selectable",!e.perimeterLightsEnabled),t(),C(" ",g(63,76,"yes")," (+",e.totalPerimeterLightsPrice,"\u20AC) "),t(2),m("tax",e.tax)("totalPrice",e.totalPrice)("totalPriceWithTax",e.totalPriceWithTax))},dependencies:[D,J,H,K,Q,k,z,N,G,A,R,q,U,X,E,$,ee,Z,Y],styles:[".flat-pergola[_ngcontent-%COMP%]{min-width:320px;margin-top:24px;min-height:90%}.column-number-field[_ngcontent-%COMP%], .perimeter-lights-field[_ngcontent-%COMP%]{align-self:start}@media (max-width: 535px){.column-number-field[_ngcontent-%COMP%]{width:100%}}"]})};export{ie as FlatPergolaComponent};
